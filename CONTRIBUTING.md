# Вклад и автоматизация (CONTRIBUTING)

Этот документ описывает правила оформления коммитов, автоматических коммитов и автопуша, а также общие требования к коммуникации в репозитории.

Язык
- По умолчанию: русский. Пишите описания в README, комментарии в коде и обсуждения в issues/PR на русском языке, если нет строгой необходимости использовать английский.

Правила коммитов
- Человеческие коммиты должны быть понятными и содержать одно предложение в заголовке + при необходимости более подробное тело.
- Формат заголовка (конвенция):

  <тип>(<область>): короткое описание

  Примеры типов:
  - feat: новая функциональность
  - fix: исправление бага
  - chore: вспомогательные изменения/рефакторинг
  - docs: документация
  - test: тесты
  - ci: изменения CI

  Пример: `feat(devblog): add admin UI for projects`

Автоматические коммиты (боты/скрипты)
- Автоматические коммиты от скриптов или CI должны иметь префикс `chore(auto):` или `ci(auto):` и в теле содержать структурированное описание сделанных действий.
- Обязательные поля в теле автокоммита (пример):

  - `Tool`: имя инструмента/скрипта, выполнившего изменение (например `devblog/migrate`)
  - `Action`: короткое описание действия (`update deps`, `bump version`, `format code`)
  - `Details`: при необходимости — дополнительные детали (какие файлы, версии, причины)

  Пример автокоммита:

  Заголовок: `chore(auto): bump requirements for devblog`

  Тело:

  Tool: tools/devblog/scripts/auto_update_deps.py
  Action: update requirements.txt -> upgraded requests 2.31.0 -> 2.32.0
  Details: обновлены зависимости для исправления CVE-xxxx

- Автоматические коммиты должны указывать автора/бота (например, `automation@blackburn.tools`) и, где уместно, ссылку на задачу/issue.
- Производите автокоммиты в отдельной ветке (например `auto/deps-bump/2025-12-09`) и открывайте PR в `main`, если ветка влияет на рабочую логику. Непосредственный пуш в `main` разрешён только для доверенных автоматизаций и должен сопровождаться соответствующими проверками CI и ревью (см. правила ветвления ниже).

Автопуш из CI (рекомендации)
- Для автопуша из CI используйте отдельный service account / deploy key с минимальными правами.
- Рекомендуемый поток:
  1. CI выполняет изменения в рабочей директории.
  2. CI создаёт ветку `auto/<task>-<timestamp>`.
  3. CI совершает коммит с сообщением в формате автокоммита и пушит ветку.
  4. CI создаёт Pull Request в `main` или целевую ветку и добавляет описание/ссылки.

- Если нужно выполнить быстрый автопуш без PR (опция для тривиальных изменений), настройте исключения в политике репозитория и включите дополнительные проверки в CI (например, прохождение тестов, сигнатуры, и т.д.).

Пример PowerShell-скрипта для автоматического коммита/push (использовать в CI):

```powershell
# предполагается, что CI имеет SSH ключ в агенте и рабочая директория — репозиторий
$branch = "auto/deps-bump/$(Get-Date -Format yyyy-MM-dd_HH-mm-ss)"
git checkout -b $branch
git add requirements.txt
git commit -m "chore(auto): bump requirements for devblog" -m "Tool: tools/devblog/scripts/auto_update_deps.py`nAction: bump requests 2.31.0 -> 2.32.0`nDetails: security patch"
git push origin $branch

# Создать PR можно через GitHub CLI (gh) если он доступен в CI
gh pr create --title "chore(auto): bump requirements for devblog" --body "Automated dependency bump from CI" --base main --head $branch
```

Политика ветвления и ревью
- Основная ветка: `main` — поддерживается в рабочем состоянии. Защищайте её правилами (require PR reviews, status checks).
- Фичевые ветки: `feat/...`, багфикс: `fix/...`, автоматические: `auto/...`.
- Перед слиянием в `main` — обязательный набор статус-чеков: линтер/ruff, тесты (pytest), сборка/compile.

Прямые пуши в `main` (одиночный разработчик)
- Если вы единственный активный разработчик в этом репозитории и хотите упростить рабочий поток, прямые пуши в `main` допустимы.
- Рекомендации при прямых пушах:
  - Всегда запускайте локально линтер и тесты перед пушем (`ruff`, `pytest`, `python -m compileall .`).
  - Держите `CONTRIBUTING.md` и `README.md` в актуальном состоянии.
  - Используйте понятные сообщения коммитов согласно правилам в этом файле.
  - По возможности создавайте резервные ветки перед крупными изменениями: `git checkout -b backup/<task>-<timestamp>` и пушьте её в удалённый репозиторий.
- Если позже в проект подключатся другие участники — верните строгие правила (PR + ревью + статус-чексы).

Безопасность и права
- Не храните секреты в репозитории. Для автопуша используйте secrets в CI и ограниченные deploy-keys.
- Логи и уведомления должны скрывать секреты и чувствительные данные.

Если нужно, могу подготовить шаблонный CI-скрипт (GitHub Actions) для безопасного автопуша с созданием ветки и PR.